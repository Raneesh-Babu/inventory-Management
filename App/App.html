<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invento Mobile</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4bb543;
            --danger: #dc3545;
            --warning: #ffc107;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--light);
            color: var(--gray-800);
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        .app-container.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10000;
        }

        .app-container.keyboard-active {
            height: 100vh;
            overflow: hidden;
        }

        .app-container.unauthorized .sidebar,
        .app-container.unauthorized .top-bar {
            display: none !important;
        }

        .app-container.unauthorized .main-content {
            width: 100%;
        }

        .app-container.unauthorized .iframe-container {
            height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 260px;
            background: white;
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar.collapsed .nav-text,
        .sidebar.collapsed .app-subtitle,
        .sidebar.collapsed .logout-text {
            display: none;
        }

        .sidebar.collapsed .app-title {
            font-size: 14px;
        }

        .sidebar.collapsed .nav-item {
            justify-content: center;
            padding: 12px;
        }

        .sidebar.collapsed .nav-icon {
            margin-right: 0;
            font-size: 18px;
        }

        .app-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            text-align: center;
            position: relative;
        }

        .collapse-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .collapse-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .sidebar.collapsed .collapse-toggle {
            transform: rotate(180deg);
        }

        .app-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 5px;
            transition: var(--transition);
        }

        .app-subtitle {
            font-size: 12px;
            opacity: 0.9;
            transition: var(--transition);
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--gray-700);
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: var(--gray-100);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .nav-item.active {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
            font-weight: 500;
        }

        .nav-icon {
            width: 24px;
            text-align: center;
            margin-right: 12px;
            font-size: 16px;
            flex-shrink: 0;
            transition: var(--transition);
        }

        .nav-text {
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
        }

        .nav-footer {
            padding: 20px;
            border-top: 1px solid var(--gray-200);
            margin-top: auto;
        }

        .logout-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 12px 16px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .logout-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .logout-icon {
            margin-right: 8px;
            font-size: 14px;
            flex-shrink: 0;
        }

        .logout-text {
            transition: var(--transition);
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--gray-100);
            min-width: 0;
            height: 100vh;
            overflow: hidden;
            transition: var(--transition);
        }

        .keyboard-active .main-content {
            height: 100vh;
            overflow: visible;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid var(--gray-200);
            flex-shrink: 0;
            z-index: 100;
            transition: var(--transition);
        }

        @media (max-width: 768px) {
            .keyboard-active .top-bar {
                transform: translateY(-100%);
                opacity: 0;
            }
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 18px;
            color: var(--gray-700);
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: var(--transition);
        }

        .menu-toggle:hover {
            background: var(--gray-100);
            color: var(--primary);
        }

        .current-page {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-800);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shop-badge {
            background: var(--gray-100);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--gray-600);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .shop-badge:hover {
            background: var(--gray-200);
        }

        /* Context Menu for Logout */
        .context-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 8px;
            min-width: 150px;
            z-index: 1000;
            display: none;
            margin-top: 5px;
        }

        .context-menu.active {
            display: block;
        }

        .context-menu-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            color: var(--gray-700);
            text-decoration: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        .context-menu-item:hover {
            background: var(--gray-100);
            color: var(--danger);
        }

        .context-menu-icon {
            margin-right: 8px;
            width: 16px;
            text-align: center;
        }

        /* Full screen button */
        .fullscreen-toggle {
            background: none;
            border: none;
            color: var(--gray-600);
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: var(--transition);
            font-size: 14px;
        }

        .fullscreen-toggle:hover {
            background: var(--gray-100);
            color: var(--primary);
        }

        /* Iframe Container */
        .iframe-container {
            flex: 1;
            position: relative;
            background: white;
            min-height: 0;
            overflow: hidden;
            height: calc(100vh - 70px);
            width: 100%;
            transition: var(--transition);
        }

        .keyboard-active .iframe-container {
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
        }

        .content-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            display: block;
            pointer-events: auto;
        }

        .iframe-wrapper {
            width: 100%;
            height: 100%;
            overflow: auto;
            overflow-x: hidden;
            position: relative;
            transition: var(--transition);
        }

        .keyboard-active .iframe-wrapper {
            height: 100vh;
            padding-bottom: 0;
        }

        /* Floating action button for keyboard close */
        .keyboard-close-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            z-index: 1001;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            display: none;
        }

        .keyboard-close-btn.active {
            display: flex;
        }

        .keyboard-close-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 15px;
            z-index: 10;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--gray-200);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            color: var(--gray-600);
            font-size: 14px;
        }

        /* Security Warning */
        .security-warning {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            color: white;
            font-size: 18px;
            text-align: center;
            padding: 20px;
            display: none;
        }

        .security-warning.active {
            display: flex;
        }

        .warning-content {
            background: var(--danger);
            padding: 30px;
            border-radius: var(--border-radius);
            max-width: 400px;
            box-shadow: var(--box-shadow);
        }

        .warning-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        /* Iframe Overlay for Security */
        .iframe-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            z-index: 5;
            display: none;
        }

        .iframe-overlay.active {
            display: block;
        }

        /* Logout Confirmation Modal */
        .logout-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            display: none;
        }

        .logout-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 400px;
            padding: 30px;
            text-align: center;
            animation: modalFadeIn 0.3s ease;
        }

        .modal-icon {
            font-size: 48px;
            color: var(--danger);
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--gray-800);
        }

        .modal-message {
            color: var(--gray-600);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            min-width: 100px;
        }

        .modal-btn-cancel {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .modal-btn-cancel:hover {
            background: var(--gray-300);
        }

        .modal-btn-confirm {
            background: var(--danger);
            color: white;
        }

        .modal-btn-confirm:hover {
            background: #c82333;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Page Content Styles */
        .page-content {
            padding: 20px;
            overflow-y: auto;
            height: 100%;
        }

        .page-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-300);
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 5px;
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--gray-600);
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-200);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-800);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--gray-700);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            transition: var(--transition);
            background-color: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #3a9a35;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th,
        .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        .table th {
            background: var(--gray-100);
            font-weight: 600;
            color: var(--gray-700);
            font-size: 14px;
        }

        .table tr:hover {
            background: var(--gray-50);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray-600);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                position: absolute;
                left: -260px;
                top: 0;
                bottom: 0;
                width: 260px;
                transition: var(--transition);
            }

            .sidebar.active {
                left: 0;
            }

            .sidebar.collapsed {
                width: 260px;
            }

            .menu-toggle {
                display: block;
            }

            .main-content {
                width: 100%;
            }

            .collapse-toggle {
                display: none;
            }

            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
                display: none;
            }

            .overlay.active {
                display: block;
            }

            .iframe-container {
                height: calc(100vh - 70px);
            }

            .context-menu {
                right: 10px;
            }

            .keyboard-active .sidebar {
                display: none;
            }

            .keyboard-active .overlay {
                display: none;
            }

            .modal-actions {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar Styling */
        .nav-menu::-webkit-scrollbar {
            width: 4px;
        }

        .nav-menu::-webkit-scrollbar-track {
            background: var(--gray-100);
        }

        .nav-menu::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: 2px;
        }

        .nav-menu::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }

        .iframe-wrapper::-webkit-scrollbar {
            width: 8px;
        }

        .iframe-wrapper::-webkit-scrollbar-track {
            background: var(--gray-100);
        }

        .iframe-wrapper::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: 4px;
        }

        .iframe-wrapper::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }

        html, body {
            overflow: hidden;
            height: 100%;
        }
    </style>
</head>
<body>
<div class="app-container" id="appContainer">
    <!-- Keyboard Close Button -->
    <button class="keyboard-close-btn" id="keyboardCloseBtn">
        <i class="fas fa-keyboard"></i>
    </button>

    <!-- Security Warning -->
    <div class="security-warning" id="securityWarning">
        <div class="warning-content">
            <div class="warning-icon">
                <i class="fas fa-shield-alt"></i>
            </div>
            <h3>Security Violation Detected</h3>
            <p>Copying content is not permitted in the application.</p>
            <button id="closeWarning" style="margin-top: 20px; padding: 10px 20px; background: white; color: var(--danger); border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                Close
            </button>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div class="logout-modal" id="logoutModal">
        <div class="modal-content">
            <div class="modal-icon">
                <i class="fas fa-sign-out-alt"></i>
            </div>
            <div class="modal-title">Confirm Logout</div>
            <div class="modal-message">Are you sure you want to logout from the application?</div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" id="cancelLogout">Cancel</button>
                <button class="modal-btn modal-btn-confirm" id="confirmLogout">Confirm Logout</button>
            </div>
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
        <div class="app-header">
            <button class="collapse-toggle" id="collapseToggle">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="app-title" id="welcomeTitle">Welcome</div>
            <div class="app-subtitle">Invento Mobile</div>
        </div>

        <div class="nav-menu">
            <a href="#" class="nav-item active" data-page="Dashboard" data-target="dashboard">
                <div class="nav-icon"><i class="fas fa-tachometer-alt"></i></div>
                <div class="nav-text">Dashboard</div>
            </a>
            
            <a href="#" class="nav-item" data-page="Add Users" data-target="add-user">
                <div class="nav-icon"><i class="fas fa-user-plus"></i></div>
                <div class="nav-text">Add Users</div>
            </a>
            
            <a href="#" class="nav-item" data-page="Add Customer" data-target="add-customer">
                <div class="nav-icon"><i class="fas fa-users"></i></div>
                <div class="nav-text">Add Customer</div>
            </a>
            
            <a href="#" class="nav-item" data-page="Loyalty Programme" data-target="loyalty">
                <div class="nav-icon"><i class="fas fa-award"></i></div>
                <div class="nav-text">Loyalty Programme</div>
            </a>
            
            <a href="#" class="nav-item" data-page="Add Inventory" data-target="add-inventory">
                <div class="nav-icon"><i class="fas fa-boxes"></i></div>
                <div class="nav-text">Add Inventory</div>
            </a>
            
            <a href="#" class="nav-item" data-page="Inventory Report" data-target="inventory-report">
                <div class="nav-icon"><i class="fas fa-chart-bar"></i></div>
                <div class="nav-text">Inventory Report</div>
            </a>
            
            <a href="#" class="nav-item" data-page="Add Sale" data-target="add-sale">
                <div class="nav-icon"><i class="fas fa-cash-register"></i></div>
                <div class="nav-text">Add Sale</div>
            </a>
            
            <a href="#" class="nav-item" data-page="Sales Report" data-target="sales-report">
                <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
                <div class="nav-text">Sales Report</div>
            </a>
            
            <a href="#" class="nav-item" data-page="Invoice Search" data-target="invoice-search">
                <div class="nav-icon"><i class="fas fa-receipt"></i></div>
                <div class="nav-text">Invoice Search</div>
            </a>
        </div>

        <div class="nav-footer">
            <button class="logout-btn" id="logoutBtn">
                <div class="logout-icon"><i class="fas fa-sign-out-alt"></i></div>
                <div class="logout-text">Logout</div>
            </button>
        </div>
    </div>

    <!-- Overlay for mobile -->
    <div class="overlay" id="overlay"></div>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="top-bar">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="current-page" id="currentPage">Dashboard</div>
            <div class="user-info">
                <button class="fullscreen-toggle" id="fullscreenToggle" title="Toggle Fullscreen">
                    <i class="fas fa-compress"></i>
                </button>
                <div class="shop-badge" id="shopBadge">
                    Shop: Main Store
                    <!-- Context Menu for Logout -->
                    <div class="context-menu" id="contextMenu">
                        <div class="context-menu-item" id="contextLogout">
                            <div class="context-menu-icon">
                                <i class="fas fa-sign-out-alt"></i>
                            </div>
                            Logout
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="iframe-container">
            <div class="loading-overlay" id="loadingOverlay">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading Dashboard...</div>
            </div>
            <div class="iframe-wrapper" id="iframeWrapper">
                <!-- Page content will be dynamically loaded here -->
                <div class="page-content" id="pageContent">
                    <!-- Dashboard content -->
                    <div id="dashboard" class="page active">
                        <div class="page-header">
                            <h1 class="page-title">Dashboard</h1>
                            <p class="page-subtitle">Welcome to Invento Mobile - Your inventory management solution</p>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">1,254</div>
                                <div class="stat-label">Total Products</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">$12,847</div>
                                <div class="stat-label">Today's Sales</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">42</div>
                                <div class="stat-label">Low Stock Items</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">89</div>
                                <div class="stat-label">New Customers</div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Recent Sales</h2>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Invoice #</th>
                                        <th>Customer</th>
                                        <th>Date</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>INV-00125</td>
                                        <td>John Smith</td>
                                        <td>2023-06-15</td>
                                        <td>$245.50</td>
                                    </tr>
                                    <tr>
                                        <td>INV-00124</td>
                                        <td>Sarah Johnson</td>
                                        <td>2023-06-15</td>
                                        <td>$189.75</td>
                                    </tr>
                                    <tr>
                                        <td>INV-00123</td>
                                        <td>Mike Williams</td>
                                        <td>2023-06-14</td>
                                        <td>$320.00</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Add User content -->
                    <div id="add-user" class="page">
                        <div class="page-header">
                            <h1 class="page-title">Add Users</h1>
                            <p class="page-subtitle">Create new user accounts for your team</p>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">User Information</h2>
                            </div>
                            <form id="userForm">
                                <div class="form-group">
                                    <label class="form-label" for="username">Username</label>
                                    <input type="text" class="form-control" id="username" placeholder="Enter username">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="email">Email</label>
                                    <input type="email" class="form-control" id="email" placeholder="Enter email">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="password">Password</label>
                                    <input type="password" class="form-control" id="password" placeholder="Enter password">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="role">Role</label>
                                    <select class="form-control" id="role">
                                        <option value="">Select role</option>
                                        <option value="admin">Administrator</option>
                                        <option value="manager">Manager</option>
                                        <option value="staff">Staff</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Add User</button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Add Customer content -->
                    <div id="add-customer" class="page">
                        <div class="page-header">
                            <h1 class="page-title">Add Customer</h1>
                            <p class="page-subtitle">Register new customers for your business</p>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Customer Details</h2>
                            </div>
                            <form id="customerForm">
                                <div class="form-group">
                                    <label class="form-label" for="customerName">Full Name</label>
                                    <input type="text" class="form-control" id="customerName" placeholder="Enter customer name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="customerPhone">Phone</label>
                                    <input type="tel" class="form-control" id="customerPhone" placeholder="Enter phone number">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="customerEmail">Email</label>
                                    <input type="email" class="form-control" id="customerEmail" placeholder="Enter email address">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="customerAddress">Address</label>
                                    <textarea class="form-control" id="customerAddress" rows="3" placeholder="Enter address"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">Add Customer</button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Add Inventory content -->
                    <div id="add-inventory" class="page">
                        <div class="page-header">
                            <h1 class="page-title">Add Inventory</h1>
                            <p class="page-subtitle">Add new products to your inventory</p>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Product Information</h2>
                            </div>
                            <form id="inventoryForm">
                                <div class="form-group">
                                    <label class="form-label" for="productName">Product Name</label>
                                    <input type="text" class="form-control" id="productName" placeholder="Enter product name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="productCategory">Category</label>
                                    <select class="form-control" id="productCategory">
                                        <option value="">Select category</option>
                                        <option value="electronics">Electronics</option>
                                        <option value="clothing">Clothing</option>
                                        <option value="home">Home & Garden</option>
                                        <option value="sports">Sports</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="productPrice">Price</label>
                                    <input type="number" class="form-control" id="productPrice" placeholder="Enter price" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="productQuantity">Quantity</label>
                                    <input type="number" class="form-control" id="productQuantity" placeholder="Enter quantity">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="productDescription">Description</label>
                                    <textarea class="form-control" id="productDescription" rows="3" placeholder="Enter product description"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">Add to Inventory</button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Add Sale content -->
                    <div id="add-sale" class="page">
                        <div class="page-header">
                            <h1 class="page-title">Add Sale</h1>
                            <p class="page-subtitle">Process a new sale transaction</p>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Sale Details</h2>
                            </div>
                            <form id="saleForm">
                                <div class="form-group">
                                    <label class="form-label" for="saleCustomer">Customer</label>
                                    <select class="form-control" id="saleCustomer">
                                        <option value="">Select customer</option>
                                        <option value="1">John Smith</option>
                                        <option value="2">Sarah Johnson</option>
                                        <option value="3">Mike Williams</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="saleProduct">Product</label>
                                    <select class="form-control" id="saleProduct">
                                        <option value="">Select product</option>
                                        <option value="1">Laptop Computer</option>
                                        <option value="2">Wireless Headphones</option>
                                        <option value="3">Smartphone</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="saleQuantity">Quantity</label>
                                    <input type="number" class="form-control" id="saleQuantity" placeholder="Enter quantity" min="1">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="salePrice">Unit Price</label>
                                    <input type="number" class="form-control" id="salePrice" placeholder="Enter unit price" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="saleDiscount">Discount (%)</label>
                                    <input type="number" class="form-control" id="saleDiscount" placeholder="Enter discount" min="0" max="100" step="0.01">
                                </div>
                                <button type="submit" class="btn btn-success">Complete Sale</button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Other pages would be implemented similarly -->
                    <div id="loyalty" class="page">
                        <div class="page-header">
                            <h1 class="page-title">Loyalty Programme</h1>
                            <p class="page-subtitle">Manage customer loyalty programs and rewards</p>
                        </div>
                        <div class="card">
                            <p>Loyalty programme content would go here...</p>
                        </div>
                    </div>
                    
                    <div id="inventory-report" class="page">
                        <div class="page-header">
                            <h1 class="page-title">Inventory Report</h1>
                            <p class="page-subtitle">View and analyze inventory data</p>
                        </div>
                        <div class="card">
                            <p>Inventory report content would go here...</p>
                        </div>
                    </div>
                    
                    <div id="sales-report" class="page">
                        <div class="page-header">
                            <h1 class="page-title">Sales Report</h1>
                            <p class="page-subtitle">View and analyze sales data</p>
                        </div>
                        <div class="card">
                            <p>Sales report content would go here...</p>
                        </div>
                    </div>
                    
                    <div id="invoice-search" class="page">
                        <div class="page-header">
                            <h1 class="page-title">Invoice Search</h1>
                            <p class="page-subtitle">Search and view invoice details</p>
                        </div>
                        <div class="card">
                            <p>Invoice search content would go here...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Get elements
const sidebar = document.getElementById('sidebar');
const menuToggle = document.getElementById('menuToggle');
const overlay = document.getElementById('overlay');
const navItems = document.querySelectorAll('.nav-item');
const currentPage = document.getElementById('currentPage');
const loadingOverlay = document.getElementById('loadingOverlay');
const logoutBtn = document.getElementById('logoutBtn');
const shopBadge = document.getElementById('shopBadge');
const collapseToggle = document.getElementById('collapseToggle');
const welcomeTitle = document.getElementById('welcomeTitle');
const fullscreenToggle = document.getElementById('fullscreenToggle');
const appContainer = document.getElementById('appContainer');
const contextMenu = document.getElementById('contextMenu');
const contextLogout = document.getElementById('contextLogout');
const iframeWrapper = document.getElementById('iframeWrapper');
const securityWarning = document.getElementById('securityWarning');
const closeWarning = document.getElementById('closeWarning');
const iframeOverlay = document.getElementById('iframeOverlay');
const keyboardCloseBtn = document.getElementById('keyboardCloseBtn');
const pageContent = document.getElementById('pageContent');
const pages = document.querySelectorAll('.page');

// Logout Modal elements
const logoutModal = document.getElementById('logoutModal');
const cancelLogout = document.getElementById('cancelLogout');
const confirmLogout = document.getElementById('confirmLogout');

// Authentication check
function checkAuthentication() {
    const shopIDTag = localStorage.getItem('ShopIDTag');
    const nameTag = localStorage.getItem('NameTag');
    const shopTag = localStorage.getItem('ShopTag');
    
    if (!shopIDTag || !nameTag || !shopTag) {
        // User is not authenticated
        console.log('User not authenticated, redirecting to login');
        appContainer.classList.add('unauthorized');
        
        // Update loading text
        const loadingText = loadingOverlay.querySelector('.loading-text');
        if (loadingText) {
            loadingText.textContent = 'Loading Login...';
        }
        
        // Hide navigation elements
        sidebar.style.display = 'none';
        
        return false;
    }
    
    // User is authenticated
    console.log('User authenticated');
    appContainer.classList.remove('unauthorized');
    sidebar.style.display = 'flex';
    
    return true;
}

// Initialize authentication check on page load
window.addEventListener('DOMContentLoaded', () => {
    const isAuthenticated = checkAuthentication();
    
    if (isAuthenticated) {
        // Only proceed with normal initialization if authenticated
        originalHeight = window.innerHeight;
        
        // Update UI with user info
        updateUserInterface();
    }
});

// Update UI with user information
function updateUserInterface() {
    const nameTag = localStorage.getItem('NameTag') || 'Admin';
    const shopTag = localStorage.getItem('ShopTag') || 'Main Store';
    
    // Update welcome title with user's name
    welcomeTitle.textContent = `Welcome, ${nameTag}`;

    // Update shop badge
    const shopParts = shopTag.split('-');
    const shopName = shopParts[0] || 'Shop';
    shopBadge.innerHTML = `Shop: ${shopName}`;
}

// Listen for authentication changes from iframe (login success)
window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'LOGIN_SUCCESS') {
        console.log('Login successful, updating UI');
        
        // Update localStorage with user data
        if (event.data.userData) {
            localStorage.setItem('NameTag', event.data.userData.name || 'User');
            localStorage.setItem('ShopIDTag', event.data.userData.shopId || '');
            localStorage.setItem('ShopTag', event.data.userData.shop || 'Shop');
        }
        
        // Re-check authentication
        const isAuthenticated = checkAuthentication();
        
        if (isAuthenticated) {
            // Update UI
            updateUserInterface();
            
            // Redirect to dashboard
            showPage('dashboard');
            currentPage.textContent = 'Dashboard';
            
            // Update active nav item
            navItems.forEach(nav => nav.classList.remove('active'));
            navItems[0].classList.add('active');
        }
    }
});

// Keyboard detection and adjustment
let isKeyboardActive = false;
let originalHeight = window.innerHeight;

// Detect keyboard appearance
window.addEventListener('resize', function() {
    if (window.innerHeight < originalHeight * 0.7) {
        // Keyboard is likely open
        if (!isKeyboardActive) {
            activateKeyboardMode();
        }
    } else {
        // Keyboard is likely closed
        if (isKeyboardActive) {
            deactivateKeyboardMode();
        }
    }
});

// Focus and blur events for form inputs
function setupFormKeyboardHandling() {
    const inputs = document.querySelectorAll('input, textarea, select');
    inputs.forEach(input => {
        input.addEventListener('focus', handleInputFocus);
        input.addEventListener('blur', handleInputBlur);
    });
}

function handleInputFocus(event) {
    activateKeyboardMode();
    
    // Scroll the input into view
    setTimeout(() => {
        event.target.scrollIntoView({
            behavior: 'smooth',
            block: 'center'
        });
    }, 300);
}

function handleInputBlur() {
    // Don't immediately deactivate - wait to see if another input gets focus
    setTimeout(() => {
        const activeElement = document.activeElement;
        if (!activeElement || (activeElement.tagName !== 'INPUT' && 
            activeElement.tagName !== 'TEXTAREA' && 
            activeElement.tagName !== 'SELECT')) {
            deactivateKeyboardMode();
        }
    }, 100);
}

function activateKeyboardMode() {
    if (isKeyboardActive) return;
    
    isKeyboardActive = true;
    appContainer.classList.add('keyboard-active');
    keyboardCloseBtn.classList.add('active');
    
    console.log('Keyboard mode activated');
}

function deactivateKeyboardMode() {
    if (!isKeyboardActive) return;
    
    isKeyboardActive = false;
    appContainer.classList.remove('keyboard-active');
    keyboardCloseBtn.classList.remove('active');
    
    console.log('Keyboard mode deactivated');
}

// Manual keyboard close button
keyboardCloseBtn.addEventListener('click', function() {
    // Blur any active input
    if (document.activeElement) {
        document.activeElement.blur();
    }
    
    deactivateKeyboardMode();
});

// Also close keyboard when tapping outside inputs
document.addEventListener('click', function(event) {
    if (isKeyboardActive && !event.target.matches('input, textarea, select')) {
        const activeTag = document.activeElement.tagName;
        if (activeTag === 'INPUT' || activeTag === 'TEXTAREA' || activeTag === 'SELECT') {
            return; // Don't blur if clicking outside but an input is still focused
        }
        
        deactivateKeyboardMode();
    }
});

// Security restrictions for main window - ONLY COPY RESTRICTION
document.addEventListener('copy', (e) => {
    e.preventDefault();
    showSecurityWarning('Copying content is disabled');
});

// Security warning function
function showSecurityWarning(message) {
    const warningText = securityWarning.querySelector('p');
    if (warningText) {
        warningText.textContent = message;
    }
    securityWarning.classList.add('active');
}

closeWarning.addEventListener('click', () => {
    securityWarning.classList.remove('active');
});

// Fullscreen functionality
function enterFullscreen() {
    if (!document.fullscreenElement) {
        if (appContainer.requestFullscreen) {
            appContainer.requestFullscreen();
        } else if (appContainer.webkitRequestFullscreen) {
            appContainer.webkitRequestFullscreen();
        } else if (appContainer.msRequestFullscreen) {
            appContainer.msRequestFullscreen();
        }
        appContainer.classList.add('fullscreen');
        fullscreenToggle.innerHTML = '<i class="fas fa-compress"></i>';
    }
}

function exitFullscreen() {
    if (document.exitFullscreen) {
        document.exitFullscreen();
    } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
    }
    appContainer.classList.remove('fullscreen');
    fullscreenToggle.innerHTML = '<i class="fas fa-expand"></i>';
}

fullscreenToggle.addEventListener('click', () => {
    if (!document.fullscreenElement) {
        enterFullscreen();
    } else {
        exitFullscreen();
    }
});

// Handle fullscreen change events
document.addEventListener('fullscreenchange', handleFullscreenChange);
document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
document.addEventListener('msfullscreenchange', handleFullscreenChange);

function handleFullscreenChange() {
    if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
        appContainer.classList.remove('fullscreen');
        fullscreenToggle.innerHTML = '<i class="fas fa-expand"></i>';
    } else {
        fullscreenToggle.innerHTML = '<i class="fas fa-compress"></i>';
    }
}

// Toggle sidebar on mobile
menuToggle.addEventListener('click', () => {
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
});

// Close sidebar when clicking overlay
overlay.addEventListener('click', () => {
    sidebar.classList.remove('active');
    overlay.classList.remove('active');
});

// Collapse sidebar on desktop
collapseToggle.addEventListener('click', () => {
    sidebar.classList.toggle('collapsed');
});

// Context menu for logout
shopBadge.addEventListener('click', (e) => {
    e.stopPropagation();
    contextMenu.classList.toggle('active');
});

// Close context menu when clicking elsewhere
document.addEventListener('click', (e) => {
    if (!shopBadge.contains(e.target)) {
        contextMenu.classList.remove('active');
    }
});

// Context menu logout functionality
contextLogout.addEventListener('click', () => {
    showLogoutModal();
});

// Page navigation
function showPage(pageId) {
    // Hide all pages
    pages.forEach(page => {
        page.classList.remove('active');
    });
    
    // Show the selected page
    const targetPage = document.getElementById(pageId);
    if (targetPage) {
        targetPage.classList.add('active');
    }
    
    // Setup keyboard handling for forms on the new page
    setTimeout(() => {
        setupFormKeyboardHandling();
    }, 100);
}

// Navigation handling - only if authenticated
navItems.forEach(item => {
    item.addEventListener('click', (e) => {
        // Check authentication before navigation
        if (!checkAuthentication()) {
            e.preventDefault();
            return;
        }
        
        e.preventDefault();
        
        const pageName = item.getAttribute('data-page');
        const pageTarget = item.getAttribute('data-target');
        
        // Show loading
        showLoading();
        
        // Update active state
        navItems.forEach(nav => nav.classList.remove('active'));
        item.classList.add('active');
        
        // Update current page
        currentPage.textContent = pageName;
        
        // Load content
        setTimeout(() => {
            showPage(pageTarget);
            hideLoading();
        }, 500);
        
        // Close sidebar on mobile
        if (window.innerWidth <= 768) {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        }
        
        // Close context menu
        contextMenu.classList.remove('active');
    });
});

// Loading functions
function showLoading() {
    loadingOverlay.style.display = 'flex';
}

function hideLoading() {
    loadingOverlay.style.display = 'none';
}

// Logout Modal Functions
function showLogoutModal() {
    logoutModal.classList.add('active');
    // Close context menu if open
    contextMenu.classList.remove('active');
}

function hideLogoutModal() {
    logoutModal.classList.remove('active');
}

// Logout functionality
function performLogout() {
    // Clear all localStorage data
    localStorage.clear();
    
    // Hide the modal
    hideLogoutModal();
    
    // Redirect to login page
    checkAuthentication();
}

// Logout button event listeners
logoutBtn.addEventListener('click', showLogoutModal);
cancelLogout.addEventListener('click', hideLogoutModal);
confirmLogout.addEventListener('click', performLogout);

// Close modal when clicking outside
logoutModal.addEventListener('click', (e) => {
    if (e.target === logoutModal) {
        hideLogoutModal();
    }
});

// Form submission handlers
document.getElementById('userForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    alert('User added successfully!');
    this.reset();
});

document.getElementById('customerForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    alert('Customer added successfully!');
    this.reset();
});

document.getElementById('inventoryForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    alert('Product added to inventory successfully!');
    this.reset();
});

document.getElementById('saleForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    alert('Sale completed successfully!');
    this.reset();
});

// Ensure proper height calculation
function updateIframeHeight() {
    const iframeContainer = document.querySelector('.iframe-container');
    const topBar = document.querySelector('.top-bar');
    const topBarHeight = topBar.offsetHeight;
    
    iframeContainer.style.height = `calc(100vh - ${topBarHeight}px)`;
}

// Initial setup
window.addEventListener('DOMContentLoaded', () => {
    updateIframeHeight();
    setupFormKeyboardHandling();
    
    // Set initial user data if not present
    if (!localStorage.getItem('NameTag')) {
        localStorage.setItem('NameTag', 'Admin');
        localStorage.setItem('ShopIDTag', 'SHOP001');
        localStorage.setItem('ShopTag', 'Main Store');
        updateUserInterface();
    }
});

window.addEventListener('resize', updateIframeHeight);

// Auto-hide loading after 10 seconds (fallback)
setTimeout(hideLoading, 10000);
</script>
</body>
</html>