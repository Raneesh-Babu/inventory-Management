<!DOCTYPE html>
<html>
<head>
<title>Fingerprint + Name Recognition</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; padding: 20px; background: #f4f4f9; }
input,button {
  padding: 12px 16px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #ccc;
  width: 100%;
  margin: 8px 0;
}
button {
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}
button:hover { background: #0056b3; }
pre { background: #fff; padding: 10px; border-radius: 8px; }
</style>
</head>

<body>

<h2>üîê Fingerprint + User Name Matching System</h2>

<h3>Register User & Fingerprint</h3>
<input id="username" placeholder="Enter your name">
<button onclick="registerFingerprint()">Register Fingerprint</button>

<h3>Verify Fingerprint</h3>
<button onclick="verifyFingerprint()">Scan & Identify User</button>

<h3>Status</h3>
<pre id="status">(waiting)</pre>

<script>
/* ----------------------------------------------------------
   REGISTER FINGERPRINT + SAVE NAME
-----------------------------------------------------------*/
async function registerFingerprint() {
    const userName = document.getElementById("username").value.trim();

    if (!userName) {
        return updateStatus("‚ùå Enter a name before registration.");
    }

    const challenge = new Uint8Array(32);
    crypto.getRandomValues(challenge);

    const userID = new Uint8Array(16);
    crypto.getRandomValues(userID);

    const publicKey = {
        challenge: challenge,
        rp: { name: "Fingerprint Name App" },
        user: {
            id: userID,
            name: userName,
            displayName: userName
        },
        pubKeyCredParams: [{ type: "public-key", alg: -7 }],
        authenticatorSelection: {
            authenticatorAttachment: "platform",
            userVerification: "required"
        },
        timeout: 60000
    };

    try {
        const credential = await navigator.credentials.create({ publicKey });

        const credID = btoa(String.fromCharCode(...new Uint8Array(credential.rawId)));

        // Store both fingerprint ID + user name
        localStorage.setItem("savedFingerprintID", credID);
        localStorage.setItem("savedUserName", userName);

        updateStatus(
            "‚úÖ Fingerprint registered successfully!\nSaved user name: " + userName
        );

    } catch (err) {
        updateStatus("‚ùå Registration failed: " + err);
    }
}

/* ----------------------------------------------------------
   VERIFY FINGERPRINT + DISPLAY SAVED NAME
-----------------------------------------------------------*/
async function verifyFingerprint() {
    const credIDBase64 = localStorage.getItem("savedFingerprintID");
    const savedName = localStorage.getItem("savedUserName");

    if (!credIDBase64) {
        return updateStatus("‚ùå No fingerprint registered yet.");
    }

    const credID = Uint8Array.from(atob(credIDBase64), c => c.charCodeAt(0));

    const challenge = new Uint8Array(32);
    crypto.getRandomValues(challenge);

    try {
        await navigator.credentials.get({
            publicKey: {
                challenge,
                allowCredentials: [
                    { type: "public-key", id: credID }
                ],
                userVerification: "required"
            }
        });

        updateStatus(
            "üîì Fingerprint Matched!\nüë§ User: " + savedName
        );

    } catch (err) {
        updateStatus("‚ùå Fingerprint verification failed: " + err);
    }
}

/* ----------------------------------------------------------*/
function updateStatus(msg) {
    document.getElementById("status").textContent = msg;
}
</script>

</body>
</html>