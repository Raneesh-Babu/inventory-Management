<!DOCTYPE html>
<html>
<head>
<title>Create Fingerprint Key</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial; padding: 20px; }
button {
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  background: #007bff;
  color: white;
  font-size: 16px;
  margin: 10px 0;
}
pre { background: #eee; padding: 15px; border-radius: 10px; }
</style>
</head>
<body>

<h2>üîê Create Fingerprint Key</h2>
<p>This step will create a biometric-protected key using your device's fingerprint/face unlock.</p>

<button onclick="createFingerprintKey()">Create Fingerprint Key</button>

<h3>Status:</h3>
<pre id="status">(waiting)</pre>

<script>
async function createFingerprintKey() {

    if (!window.PublicKeyCredential) {
        document.getElementById("status").textContent = "‚ùå WebAuthn not supported.";
        return;
    }

    // Random values for challenge + user ID
    const challenge = new Uint8Array(32);
    crypto.getRandomValues(challenge);

    const userID = new Uint8Array(16);
    crypto.getRandomValues(userID);

    const publicKey = {
        challenge: challenge,
        rp: { name: "My Secure App" },
        user: {
            id: userID,
            name: "user@example.com",
            displayName: "Secure User"
        },
        pubKeyCredParams: [{ type: "public-key", alg: -7 }], // ES256
        authenticatorSelection: {
            authenticatorAttachment: "platform", // phone fingerprint sensor
            userVerification: "required"
        },
        timeout: 60000
    };

    try {
        const credential = await navigator.credentials.create({ publicKey });

        // Save credential ID for future authentication
        localStorage.setItem("fingerprintKeyID", btoa(
            String.fromCharCode(...new Uint8Array(credential.rawId))
        ));

        document.getElementById("status").textContent =
            "‚úÖ Fingerprint key created successfully!\nStored key ID:\n" +
            localStorage.getItem("fingerprintKeyID");

    } catch (err) {
        document.getElementById("status").textContent = "‚ùå Error: " + err;
    }
}
</script>

</body>
</html>